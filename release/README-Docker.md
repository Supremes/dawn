# Dawn Docker Setup

è¿™ä¸ªç›®å½•åŒ…å«äº† Dawn åšå®¢å¹³å°çš„ Docker Compose é…ç½®æ–‡ä»¶å’Œç›¸å…³å·¥å…·ã€‚

## ğŸ“ ç›®å½•ç»“æ„

```
release/
â”œâ”€â”€ docker-compose.yaml          # ä¸»è¦çš„ Docker Compose é…ç½®
â”œâ”€â”€ .env                        # ç¯å¢ƒå˜é‡é…ç½®æ–‡ä»¶
â”œâ”€â”€ Dockerfile                  # åº”ç”¨å®¹å™¨æ„å»ºæ–‡ä»¶
â”œâ”€â”€ dawn.sql                  # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â”œâ”€â”€ vue/                        # å‰ç«¯æ„å»ºæ–‡ä»¶
â”œâ”€â”€ config/                     # é…ç½®æ–‡ä»¶ç›®å½•
â”‚   â”œâ”€â”€ mysql/
â”‚   â”‚   â””â”€â”€ my.cnf             # MySQL é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ nginx/
â”‚   â”‚   â””â”€â”€ nginx.conf         # Nginx é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ elasticsearch/
â”‚       â””â”€â”€ elasticsearch.yml   # Elasticsearch é…ç½®æ–‡ä»¶
â”œâ”€â”€ scripts/                    # ç®¡ç†è„šæœ¬ç›®å½•
â”‚   â”œâ”€â”€ manage.sh              # é¡¹ç›®ç®¡ç†ä¸»è„šæœ¬
â”‚   â”œâ”€â”€ backup.sh              # æ•°æ®å¤‡ä»½è„šæœ¬
â”‚   â”œâ”€â”€ restore.sh             # æ•°æ®æ¢å¤è„šæœ¬
â”‚   â”œâ”€â”€ generate-ssl.sh        # SSLè¯ä¹¦ç”Ÿæˆè„šæœ¬
â”‚   â”œâ”€â”€ dawn-start.sh        # å¯åŠ¨è„šæœ¬
â”‚   â”œâ”€â”€ replace-vue.sh         # Vueæ–‡ä»¶æ›¿æ¢è„šæœ¬
â”‚   â””â”€â”€ restart.sh             # é‡å¯è„šæœ¬
â”œâ”€â”€ ssl/                        # SSLè¯ä¹¦ç›®å½•
â”œâ”€â”€ logs/                       # æ—¥å¿—æ–‡ä»¶ç›®å½•
â”œâ”€â”€ backups/                    # å¤‡ä»½æ–‡ä»¶ç›®å½•ï¼ˆè¿è¡Œæ—¶åˆ›å»ºï¼‰
â””â”€â”€ tmp-files/                  # ä¸´æ—¶æ–‡ä»¶ç›®å½•
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

ç¡®ä¿æ‚¨å·²å®‰è£…ï¼š
- Docker (>= 20.0)
- Docker Compose (>= 2.0)

### 2. é…ç½®ç¯å¢ƒå˜é‡

```bash
# ç¯å¢ƒå˜é‡å·²ç»æ˜¯æ­£å¼çš„ .env æ–‡ä»¶ï¼Œæ ¹æ®éœ€è¦ä¿®æ”¹é…ç½®
vim .env
```

### 3. å¯åŠ¨æœåŠ¡

```bash
# ä½¿ç”¨ç®¡ç†è„šæœ¬å¯åŠ¨ï¼ˆæ¨èï¼‰
./scripts/manage.sh start

# æˆ–è€…ç›´æ¥ä½¿ç”¨ docker-compose
docker-compose up -d
```

### 4. æ£€æŸ¥æœåŠ¡çŠ¶æ€

```bash
./scripts/manage.sh status
```

## ğŸ”§ ç®¡ç†è„šæœ¬ä½¿ç”¨

### ä¸»ç®¡ç†è„šæœ¬ (manage.sh)

```bash
# æŸ¥çœ‹å¸®åŠ©
./scripts/manage.sh help

# å¯åŠ¨æ‰€æœ‰æœåŠ¡
./scripts/manage.sh start

# åœæ­¢æ‰€æœ‰æœåŠ¡
./scripts/manage.sh stop

# é‡å¯æœåŠ¡
./scripts/manage.sh restart

# æŸ¥çœ‹æœåŠ¡çŠ¶æ€
./scripts/manage.sh status

# æŸ¥çœ‹æ—¥å¿—ï¼ˆæ‰€æœ‰æœåŠ¡ï¼‰
./scripts/manage.sh logs

# æŸ¥çœ‹ç‰¹å®šæœåŠ¡æ—¥å¿—
./scripts/manage.sh logs dawn

# æ„å»ºåº”ç”¨é•œåƒ
./scripts/manage.sh build

# æ¸…ç†èµ„æº
./scripts/manage.sh clean

# é‡ç½®æ‰€æœ‰æ•°æ®ï¼ˆå±é™©æ“ä½œï¼‰
./scripts/manage.sh reset
```

### å¤‡ä»½å’Œæ¢å¤

```bash
# åˆ›å»ºæ•°æ®å¤‡ä»½
./scripts/backup.sh

# æŸ¥çœ‹å¯ç”¨å¤‡ä»½
./scripts/restore.sh

# æ¢å¤æ•°æ®åº“
./scripts/restore.sh mysql_20240715_143000.sql.gz
```

### SSLè¯ä¹¦ç”Ÿæˆ

```bash
# ç”Ÿæˆè‡ªç­¾åSSLè¯ä¹¦
./scripts/generate-ssl.sh
```

## ğŸ—ï¸ æ¶æ„ç»„ä»¶

### æ•°æ®åº“å±‚
- **MySQL 8.0**: ä¸»æ•°æ®åº“ï¼Œå­˜å‚¨ç”¨æˆ·æ•°æ®ã€æ–‡ç« ã€è¯„è®ºç­‰
- **Redis 7.2**: ç¼“å­˜å±‚ï¼Œæå‡æ€§èƒ½

### ä¸­é—´ä»¶å±‚
- **RabbitMQ 3.12**: æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå¤„ç†å¼‚æ­¥ä»»åŠ¡
- **Elasticsearch 7.17**: æœç´¢å¼•æ“ï¼Œæä¾›å…¨æ–‡æœç´¢åŠŸèƒ½
- **MinIO**: å¯¹è±¡å­˜å‚¨ï¼Œç®¡ç†æ–‡ä»¶ä¸Šä¼ 

### åº”ç”¨å±‚
- **Dawn App**: Spring Boot åº”ç”¨ï¼Œæä¾› API å’Œç®¡ç†ç•Œé¢
- **Nginx**: åå‘ä»£ç†å’Œé™æ€æ–‡ä»¶æœåŠ¡å™¨

## ğŸŒ æœåŠ¡è®¿é—®

å¯åŠ¨æœåŠ¡åï¼Œæ‚¨å¯ä»¥é€šè¿‡ä»¥ä¸‹åœ°å€è®¿é—®ï¼š

- **åšå®¢å‰å°**: http://localhost
- **ç®¡ç†åå°**: http://localhost:8888
- **åº”ç”¨ API**: http://localhost:8080
- **ç®¡ç† API**: http://localhost:8081
- **RabbitMQ ç®¡ç†**: http://localhost:15672 (guest/guest)
- **MinIO æ§åˆ¶å°**: http://localhost:9001 (minioadmin/minioadmin)
- **Elasticsearch**: http://localhost:9200

## ğŸ“Š æ•°æ®æŒä¹…åŒ–

æ‰€æœ‰æœåŠ¡æ•°æ®éƒ½å­˜å‚¨åœ¨ Docker å‘½åå·ä¸­ï¼š

- `mysql_data` - æ•°æ®åº“æ–‡ä»¶
- `redis_data` - ç¼“å­˜æ•°æ®
- `elasticsearch_data` - æœç´¢ç´¢å¼•
- `minio_data` - å¯¹è±¡å­˜å‚¨
- `dawn_logs` - åº”ç”¨æ—¥å¿—
- `dawn_uploads` - ç”¨æˆ·ä¸Šä¼ æ–‡ä»¶

## ğŸ”’ å®‰å…¨é…ç½®

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

1. **ä¿®æ”¹é»˜è®¤å¯†ç **: æ›´æ–° `.env` æ–‡ä»¶ä¸­çš„æ‰€æœ‰å¯†ç 
2. **å¯ç”¨ HTTPS**: ä½¿ç”¨ `generate-ssl.sh` ç”Ÿæˆè¯ä¹¦æˆ–é…ç½®æ­£å¼è¯ä¹¦
3. **ç½‘ç»œå®‰å…¨**: é…ç½®é˜²ç«å¢™è§„åˆ™ï¼Œåªå¼€æ”¾å¿…è¦ç«¯å£
4. **å®šæœŸå¤‡ä»½**: è®¾ç½®å®šæ—¶ä»»åŠ¡è¿è¡Œ `backup.sh`
5. **ç›‘æ§æ—¥å¿—**: å®šæœŸæ£€æŸ¥åº”ç”¨å’Œç³»ç»Ÿæ—¥å¿—

### å¼€å‘ç¯å¢ƒ

å½“å‰é…ç½®é€‚ç”¨äºå¼€å‘ç¯å¢ƒï¼ŒåŒ…å«äº†ä¾¿äºè°ƒè¯•çš„è®¾ç½®ï¼š
- è°ƒè¯•ç«¯å£å¼€æ”¾ (5005)
- è¯¦ç»†çš„å¥åº·æ£€æŸ¥
- å¼€å‘å‹å¥½çš„æ—¥å¿—é…ç½®

## ğŸ› ï¸ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

1. **æœåŠ¡å¯åŠ¨å¤±è´¥**
   ```bash
   # æ£€æŸ¥æ—¥å¿—
   ./scripts/manage.sh logs [service-name]
   
   # æ£€æŸ¥ç«¯å£å ç”¨
   netstat -tlnp | grep [port]
   ```

2. **æ•°æ®åº“è¿æ¥å¤±è´¥**
   ```bash
   # æ£€æŸ¥MySQLæœåŠ¡çŠ¶æ€
   docker-compose ps mysql
   
   # æ£€æŸ¥æ•°æ®åº“è¿æ¥
   docker-compose exec mysql mysql -u root -p
   ```

3. **å†…å­˜ä¸è¶³**
   - é‡æ„åå·²ç§»é™¤èµ„æºé™åˆ¶ï¼ŒæœåŠ¡å¯ä»¥ä½¿ç”¨æ‰€æœ‰å¯ç”¨èµ„æº
   - å¦‚éœ€é™åˆ¶ï¼Œå¯åœ¨ docker-compose.yaml ä¸­é‡æ–°æ·»åŠ  deploy é…ç½®

### æ—¥å¿—ä½ç½®

- **å®¹å™¨æ—¥å¿—**: ä½¿ç”¨ `docker-compose logs` æŸ¥çœ‹
- **åº”ç”¨æ—¥å¿—**: å­˜å‚¨åœ¨ `dawn_logs` å·ä¸­
- **Nginxæ—¥å¿—**: å­˜å‚¨åœ¨ `nginx_logs` å·ä¸­
- **ç³»ç»Ÿæ—¥å¿—**: åœ¨ `logs/` ç›®å½•ä¸­

## ğŸ”„ ç‰ˆæœ¬å‡çº§

```bash
# 1. å¤‡ä»½æ•°æ®
./scripts/backup.sh

# 2. åœæ­¢æœåŠ¡
./scripts/manage.sh stop

# 3. æ›´æ–°ä»£ç /é•œåƒ
git pull
docker-compose pull

# 4. é‡æ–°æ„å»ºåº”ç”¨
./scripts/manage.sh build

# 5. å¯åŠ¨æœåŠ¡
./scripts/manage.sh start
```

## ğŸ“ æŠ€æœ¯æ”¯æŒ

å¦‚æœæ‚¨é‡åˆ°é—®é¢˜ï¼Œè¯·æ£€æŸ¥ï¼š

1. Docker å’Œ Docker Compose ç‰ˆæœ¬æ˜¯å¦ç¬¦åˆè¦æ±‚
2. ç³»ç»Ÿèµ„æºæ˜¯å¦å……è¶³ï¼ˆå†…å­˜ã€ç£ç›˜ç©ºé—´ï¼‰
3. ç½‘ç»œç«¯å£æ˜¯å¦è¢«å ç”¨
4. é…ç½®æ–‡ä»¶è¯­æ³•æ˜¯å¦æ­£ç¡®

æ›´å¤šå¸®åŠ©è¯·å‚è€ƒé¡¹ç›®æ–‡æ¡£æˆ–æäº¤ Issueã€‚
